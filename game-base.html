<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo da Cobrinha</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Press Start 2P', cursive;
            touch-action: none; /* Desabilita o zoom por toque em dispositivos móveis */
        }
        #gameCanvas {
            /* A cor de fundo é agora controlada no JavaScript para o padrão de xadrez */
            border: 8px solid #4a5568;
            border-radius: 8px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2), 0 6px 6px rgba(0,0,0,0.25);
        }
        .btn-control, .shop-btn {
            transition: all 0.1s ease-in-out;
        }
        .btn-control:active, .shop-btn:active {
            transform: scale(0.95);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
        }
        .shop-item-preview {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid #cbd5e0;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-lg mx-auto text-center relative">
        <h1 class="text-4xl md:text-5xl font-bold mb-2 text-green-400 tracking-wider">SNAKE</h1>
        <div class="flex justify-between items-center bg-gray-800 p-3 rounded-lg shadow-lg mb-4 text-sm md:text-base">
            <div class="flex items-center space-x-2">
                <!-- Ícone da Maçã Vermelha em SVG -->
                <svg width="24" height="24" viewBox="0 0 100 100">
                    <path d="M85,50 C85,30 75,15 60,15 C45,15 35,30 35,50 C35,70 45,85 60,85 C75,85 85,70 85,50" fill="#e53e3e"/>
                    <path d="M65,50 C65,30 55,15 40,15 C25,15 15,30 15,50 C15,70 25,85 40,85 C55,85 65,70 65,50" fill="#c53030"/>
                    <path d="M50,15 C55,5 65,5 70,15" stroke="#48bb78" stroke-width="8" fill="none" stroke-linecap="round"/>
                </svg>
                <span id="totalRedAppleScore" class="font-bold text-yellow-400">0</span>
            </div>
            <div class="flex items-center space-x-2">
                <!-- Ícone da Maçã Dourada em SVG -->
                <svg width="24" height="24" viewBox="0 0 100 100">
                    <path d="M85,50 C85,30 75,15 60,15 C45,15 35,30 35,50 C35,70 45,85 60,85 C75,85 85,70 85,50" fill="#f6e05e"/>
                    <path d="M65,50 C65,30 55,15 40,15 C25,15 15,30 15,50 C15,70 25,85 40,85 C55,85 65,70 65,50" fill="#f6ad55"/>
                    <path d="M50,15 C55,5 65,5 70,15" stroke="#48bb78" stroke-width="8" fill="none" stroke-linecap="round"/>
                </svg>
                <span id="goldenScore" class="font-bold text-yellow-400">0</span>
            </div>
            <button id="restartButton" class="bg-green-500 hover:bg-green-600 text-gray-900 font-bold py-2 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-green-400 transition-transform transform hover:scale-105 text-xs md:text-sm">
                REINICIAR
            </button>
        </div>

        <!-- Canvas do Jogo -->
        <canvas id="gameCanvas" width="400" height="400"></canvas>

        <!-- Mensagem de Game Over -->
        <div id="gameOverMessage" class="hidden absolute inset-0 bg-black bg-opacity-70 flex flex-col justify-center items-center text-center p-4">
            <h2 class="text-3xl sm:text-5xl text-red-500 font-bold">FIM DE JOGO</h2>
            <p class="text-xl sm:text-2xl mt-4">Maçãs nesta partida: <span id="finalScore">0</span></p>
            
            <button id="restartButtonGameOver" class="mt-8 bg-green-500 hover:bg-green-600 text-gray-900 font-bold py-2 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-green-400 transition-transform transform hover:scale-105">
                JOGAR NOVAMENTE
            </button>
            <button id="shopButton" class="mt-4 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                LOJA
            </button>
        </div>

        <!-- Menu da Loja -->
        <div id="shopMenu" class="hidden absolute inset-0 bg-gray-900 bg-opacity-95 flex flex-col justify-start items-center text-center p-4">
            <h2 class="text-3xl text-yellow-400 font-bold mb-4">LOJA DE SKINS</h2>
            <div id="shopItemsContainer" class="w-full space-y-3 overflow-y-auto max-h-64">
                <!-- Items da loja serão inseridos aqui -->
            </div>
            <button id="backToGameOverButton" class="mt-auto bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-md">
                VOLTAR
            </button>
        </div>
    </div>

    <!-- Controles para Dispositivos Móveis -->
    <div class="mt-6 grid grid-cols-3 gap-3 w-48 md:hidden">
        <div></div>
        <button id="upBtn" class="btn-control bg-gray-700 p-4 rounded-lg shadow-md">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" /></svg>
        </button>
        <div></div>
        <button id="leftBtn" class="btn-control bg-gray-700 p-4 rounded-lg shadow-md">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
        </button>
        <button id="downBtn" class="btn-control bg-gray-700 p-4 rounded-lg shadow-md">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
        </button>
        <button id="rightBtn" class="btn-control bg-gray-700 p-4 rounded-lg shadow-md">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
        </button>
    </div>


    <script>
        // --- Configurações Iniciais ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const totalRedAppleScoreElement = document.getElementById('totalRedAppleScore');
        const goldenScoreElement = document.getElementById('goldenScore');
        const restartButton = document.getElementById('restartButton');
        const gameOverMessage = document.getElementById('gameOverMessage');
        const finalScoreElement = document.getElementById('finalScore');
        const restartButtonGameOver = document.getElementById('restartButtonGameOver');
        const shopButton = document.getElementById('shopButton');
        const shopMenu = document.getElementById('shopMenu');
        const backToGameOverButton = document.getElementById('backToGameOverButton');
        const shopItemsContainer = document.getElementById('shopItemsContainer');

        const gridSize = 20;
        const maxFoods = 2;
        let snake = [];
        let foods = [];
        let dx = 0;
        let dy = 0;
        let sessionRedAppleCount = 0;
        let totalRedApples = 0;
        let totalGoldenPoints = 0;
        let changingDirection = false;
        let gameLoop;
        let isGameOver = false;
        let currentSkin;

        // --- Configuração da Loja ---
        const skins = [
            { id: 'green', name: 'Verde Clássico', head: '#48bb78', body: '#38a169', cost: 0 },
            { id: 'blue', name: 'Azul Elétrico', head: '#4299e1', body: '#3182ce', cost: 10 },
            { id: 'purple', name: 'Roxo Real', head: '#9f7aea', body: '#805ad5', cost: 100 },
            { id: 'orange', name: 'Laranja Atômico', head: '#f6ad55', body: '#ed8936', cost: 1000 }
        ];

        // --- Funções Principais do Jogo ---

        function startGame() {
            loadEquippedSkin();
            snake = [ { x: 10, y: 10 }, { x: 9, y: 10 }, { x: 8, y: 10 } ];
            dx = 0;
            dy = 0;
            sessionRedAppleCount = 0;
            isGameOver = false;
            changingDirection = false;
            gameOverMessage.classList.add('hidden');
            shopMenu.classList.add('hidden');

            loadSavedScores();

            foods = [];
            for(let i = 0; i < maxFoods; i++) {
                spawnNewFood();
            }
            
            drawInitialState();

            if (gameLoop) clearInterval(gameLoop);
            gameLoop = setInterval(main, 150);
        }
        
        function drawInitialState() {
            clearCanvas();
            drawFoods();
            drawSnake();
        }

        function main() {
            if (isGameOver) return;
            changingDirection = false;
            clearCanvas();
            drawFoods();
            moveSnake();
            drawSnake();
            checkCollision();
        }

        function clearCanvas() {
            const darkColor = '#1a202c';
            const lightColor = '#2d3748';
            for (let x = 0; x < canvas.width / gridSize; x++) {
                for (let y = 0; y < canvas.height / gridSize; y++) {
                    ctx.fillStyle = ((x + y) % 2 === 0) ? darkColor : lightColor;
                    ctx.fillRect(x * gridSize, y * gridSize, gridSize, gridSize);
                }
            }
        }

        // --- Funções da Cobra ---

        function drawSnake() {
            ctx.strokeStyle = currentSkin.body;
            ctx.lineWidth = gridSize - 6;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';

            ctx.beginPath();
            ctx.moveTo(snake[0].x * gridSize + gridSize / 2, snake[0].y * gridSize + gridSize / 2);

            for (let i = 1; i < snake.length; i++) {
                const current = snake[i];
                const previous = snake[i - 1];
                const isWrap = Math.abs(current.x - previous.x) > 1 || Math.abs(current.y - previous.y) > 1;
                if (isWrap) {
                    ctx.stroke();
                    ctx.beginPath();
                    ctx.moveTo(current.x * gridSize + gridSize / 2, current.y * gridSize + gridSize / 2);
                } else {
                    ctx.lineTo(current.x * gridSize + gridSize / 2, current.y * gridSize + gridSize / 2);
                }
            }
            ctx.stroke();
            drawHead();
        }

        function drawHead() {
            const head = snake[0];
            const x = head.x * gridSize;
            const y = head.y * gridSize;
            const radius = gridSize / 2;

            ctx.fillStyle = currentSkin.head;
            ctx.beginPath();
            ctx.arc(x + radius, y + radius, radius - 2, 0, 2 * Math.PI);
            ctx.fill();

            ctx.fillStyle = 'white';
            const eyeRadius = 3;
            let eye1X, eye1Y, eye2X, eye2Y;
            let eyeDirection = (dx !== 0 || dy !== 0) ? {dx, dy} : {dx: 1, dy: 0};

            if (eyeDirection.dx === 1) { eye1X = x + gridSize - 6; eye1Y = y + 6; eye2X = x + gridSize - 6; eye2Y = y + gridSize - 6; } 
            else if (eyeDirection.dx === -1) { eye1X = x + 6; eye1Y = y + 6; eye2X = x + 6; eye2Y = y + gridSize - 6; } 
            else if (eyeDirection.dy === 1) { eye1X = x + 6; eye1Y = y + gridSize - 6; eye2X = x + gridSize - 6; eye2Y = y + gridSize - 6; } 
            else { eye1X = x + 6; eye1Y = y + 6; eye2X = x + gridSize - 6; eye2Y = y + 6; }
            
            ctx.beginPath();
            ctx.arc(eye1X, eye1Y, eyeRadius, 0, 2 * Math.PI);
            ctx.arc(eye2X, eye2Y, eyeRadius, 0, 2 * Math.PI);
            ctx.fill();
        }

        function moveSnake() {
            if (dx === 0 && dy === 0) return;

            const head = { x: snake[0].x + dx, y: snake[0].y + dy };
            const gridWidth = canvas.width / gridSize;
            const gridHeight = canvas.height / gridSize;

            if (head.x < 0) head.x = gridWidth - 1;
            else if (head.x >= gridWidth) head.x = 0;
            if (head.y < 0) head.y = gridHeight - 1;
            else if (head.y >= gridHeight) head.y = 0;

            snake.unshift(head);

            let ateFood = false;
            for (let i = 0; i < foods.length; i++) {
                if (head.x === foods[i].x && head.y === foods[i].y) {
                    const foodType = foods[i].type;
                    if (foodType === 'red') {
                        sessionRedAppleCount++;
                        totalRedApples++;
                        saveRedApples();
                    } else if (foodType === 'golden') {
                        totalGoldenPoints++;
                        saveGoldenPoints();
                    }
                    
                    foods.splice(i, 1);
                    spawnNewFood();
                    ateFood = true;
                    break;
                }
            }

            if (!ateFood) {
                snake.pop();
            }
        }

        // --- Funções da Comida ---

        function spawnNewFood() {
            let newFood = {};
            const chance = Math.random();
            if (chance < 0.1) { newFood.type = 'golden'; } 
            else { newFood.type = 'red'; }

            while (true) {
                newFood.x = Math.floor(Math.random() * (canvas.width / gridSize));
                newFood.y = Math.floor(Math.random() * (canvas.height / gridSize));
                let isOccupied = snake.some(part => part.x === newFood.x && part.y === newFood.y) ||
                                 foods.some(f => f.x === newFood.x && f.y === newFood.y);
                if (!isOccupied) break;
            }
            foods.push(newFood);
        }

        function drawFoods() {
            foods.forEach(food => {
                if (food.type === 'red') { drawApple(food, '#e53e3e'); } 
                else if (food.type === 'golden') { drawApple(food, '#f6e05e'); }
            });
        }

        function drawApple(food, color) {
            const x = food.x * gridSize;
            const y = food.y * gridSize;
            const radius = gridSize / 2;
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(x + radius, y + radius, radius - 2, 0, 2 * Math.PI);
            ctx.fill();
            ctx.fillStyle = '#48bb78';
            ctx.beginPath();
            ctx.moveTo(x + radius, y);
            ctx.lineTo(x + radius + 4, y + 4);
            ctx.lineTo(x + radius + 8, y + 2);
            ctx.fill();
        }

        // --- Pontuações e Skins (Persistentes) ---

        function saveRedApples() {
            localStorage.setItem('snakeRedApples', totalRedApples);
            totalRedAppleScoreElement.textContent = totalRedApples;
        }

        function saveGoldenPoints() {
            localStorage.setItem('snakeGoldenPoints', totalGoldenPoints);
            goldenScoreElement.textContent = totalGoldenPoints;
        }

        function loadSavedScores() {
            totalRedApples = parseInt(localStorage.getItem('snakeRedApples')) || 0;
            totalGoldenPoints = parseInt(localStorage.getItem('snakeGoldenPoints')) || 0;
            totalRedAppleScoreElement.textContent = totalRedApples;
            goldenScoreElement.textContent = totalGoldenPoints;
        }

        function loadEquippedSkin() {
            const equippedSkinId = localStorage.getItem('snakeEquippedSkin') || 'green';
            currentSkin = skins.find(s => s.id === equippedSkinId);
        }

        // --- Loja ---

        function populateShop() {
            shopItemsContainer.innerHTML = '';
            const purchasedSkins = JSON.parse(localStorage.getItem('snakePurchasedSkins')) || ['green'];
            const equippedSkinId = localStorage.getItem('snakeEquippedSkin') || 'green';

            skins.forEach(skin => {
                const isPurchased = purchasedSkins.includes(skin.id);
                const isEquipped = skin.id === equippedSkinId;

                const itemDiv = document.createElement('div');
                itemDiv.className = 'flex items-center justify-between bg-gray-800 p-2 rounded-lg';
                
                const previewDiv = document.createElement('div');
                previewDiv.className = 'shop-item-preview';
                previewDiv.style.backgroundColor = skin.head;
                previewDiv.style.border = `3px solid ${skin.body}`;

                const nameSpan = document.createElement('span');
                nameSpan.textContent = skin.name;
                nameSpan.className = 'text-xs';

                const button = document.createElement('button');
                button.className = 'shop-btn text-xs font-bold py-2 px-3 rounded-md';

                if (isEquipped) {
                    button.textContent = 'EQUIPADO';
                    button.disabled = true;
                    button.className += ' bg-gray-500';
                } else if (isPurchased) {
                    button.textContent = 'EQUIPAR';
                    button.className += ' bg-green-500 hover:bg-green-600';
                    button.onclick = () => equipSkin(skin.id);
                } else {
                    button.innerHTML = `COMPRAR <span class="text-yellow-300">${skin.cost}</span>`;
                    if (totalGoldenPoints >= skin.cost) {
                        button.className += ' bg-yellow-500 hover:bg-yellow-600';
                        button.onclick = () => buySkin(skin.id);
                    } else {
                        button.className += ' bg-gray-600 opacity-50';
                        button.disabled = true;
                    }
                }
                
                itemDiv.appendChild(previewDiv);
                itemDiv.appendChild(nameSpan);
                itemDiv.appendChild(button);
                shopItemsContainer.appendChild(itemDiv);
            });
        }

        function buySkin(skinId) {
            const skin = skins.find(s => s.id === skinId);
            if (totalGoldenPoints >= skin.cost) {
                totalGoldenPoints -= skin.cost;
                saveGoldenPoints();

                const purchasedSkins = JSON.parse(localStorage.getItem('snakePurchasedSkins')) || ['green'];
                purchasedSkins.push(skinId);
                localStorage.setItem('snakePurchasedSkins', JSON.stringify(purchasedSkins));
                
                populateShop(); // Atualiza a loja
            }
        }

        function equipSkin(skinId) {
            localStorage.setItem('snakeEquippedSkin', skinId);
            populateShop(); // Atualiza a loja
        }

        // --- Detecção de Colisão e Fim de Jogo ---

        function checkCollision() {
            if (dx === 0 && dy === 0) return;
            for (let i = 1; i < snake.length; i++) {
                if (snake[i].x === snake[0].x && snake[i].y === snake[0].y) {
                    gameOver();
                    return;
                }
            }
        }

        function gameOver() {
            isGameOver = true;
            clearInterval(gameLoop);
            finalScoreElement.textContent = sessionRedAppleCount;
            gameOverMessage.classList.remove('hidden');
        }

        // --- Controles ---

        function changeDirection(event) {
            if (changingDirection) return;
            const keyPressed = event.keyCode;
            const goingUp = dy === -1, goingDown = dy === 1, goingRight = dx === 1, goingLeft = dx === -1;
            if (dx === 0 && dy === 0 && keyPressed === 37) return;
            changingDirection = true;
            if (keyPressed === 37 && !goingRight) { dx = -1; dy = 0; }
            if (keyPressed === 38 && !goingDown) { dx = 0; dy = -1; }
            if (keyPressed === 39 && !goingLeft) { dx = 1; dy = 0; }
            if (keyPressed === 40 && !goingUp) { dx = 0; dy = 1; }
        }
        
        function handleTouchControls(direction) {
            if (changingDirection) return;
            const goingUp = dy === -1, goingDown = dy === 1, goingRight = dx === 1, goingLeft = dx === -1;
            if (dx === 0 && dy === 0 && direction === 'left') return;
            changingDirection = true;
            if (direction === 'up' && !goingDown) { dx = 0; dy = -1; }
            if (direction === 'down' && !goingUp) { dx = 0; dy = 1; }
            if (direction === 'left' && !goingRight) { dx = -1; dy = 0; }
            if (direction === 'right' && !goingLeft) { dx = 1; dy = 0; }
        }

        // --- Event Listeners ---
        document.addEventListener('keydown', changeDirection);
        restartButton.addEventListener('click', startGame);
        restartButtonGameOver.addEventListener('click', startGame);
        shopButton.addEventListener('click', () => {
            gameOverMessage.classList.add('hidden');
            populateShop();
            shopMenu.classList.remove('hidden');
        });
        backToGameOverButton.addEventListener('click', () => {
            shopMenu.classList.add('hidden');
            gameOverMessage.classList.remove('hidden');
        });
        
        document.getElementById('upBtn').addEventListener('click', () => handleTouchControls('up'));
        document.getElementById('downBtn').addEventListener('click', () => handleTouchControls('down'));
        document.getElementById('leftBtn').addEventListener('click', () => handleTouchControls('left'));
        document.getElementById('rightBtn').addEventListener('click', () => handleTouchControls('right'));

        // --- Iniciar o Jogo ---
        startGame();
    </script>

</body>
</html>
